
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <link rel="test image" href="{{url_for('static', filename='static/IMGS/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Tk5UvzWCL2kpn2-DFk_OKherB0H_eBC2Ke_uNztOh8QmexlkgktWjWw9iheHPGOgcoApV4E7YL50LsldLkMOq0tACPi4oTznj4kGoXuTa1_5_J.png')}}">
</head>
<body>
    <div class="navbar">
        <div class="user_profile_btn"></div>
        <div class="user_name">my name is</div>
        <div class="center_group">
            <div class="game_name">HIGHER or LOWER</div>
            <div class="score_display">Score: {{ score }}</div>
        </div>
        <div class="game_name">HIGHER or LOWER</div>
        <div id="minigamesBtn"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#001d3d"><path d="M189-160q-60 0-102.5-43T42-307q0-9 1-18t3-18l84-336q14-54 57-87.5t98-33.5h390q55 0 98 33.5t57 87.5l84 336q2 9 3.5 18.5T919-306q0 61-43.5 103.5T771-160q-42 0-78-22t-54-60l-28-58q-5-10-15-15t-21-5H385q-11 0-21 5t-15 15l-28 58q-18 38-54 60t-78 22Zm351-360q17 0 28.5-11.5T580-560q0-17-11.5-28.5T540-600q-17 0-28.5 11.5T500-560q0 17 11.5 28.5T540-520Zm80-80q17 0 28.5-11.5T660-640q0-17-11.5-28.5T620-680q-17 0-28.5 11.5T580-640q0 17 11.5 28.5T620-600Zm0 160q17 0 28.5-11.5T660-480q0-17-11.5-28.5T620-520q-17 0-28.5 11.5T580-480q0 17 11.5 28.5T620-440Zm80-80q17 0 28.5-11.5T740-560q0-17-11.5-28.5T700-600q-17 0-28.5 11.5T660-560q0 17 11.5 28.5T700-520Zm-360 60q13 0 21.5-8.5T370-490v-40h40q13 0 21.5-8.5T440-560q0-13-8.5-21.5T410-590h-40v-40q0-13-8.5-21.5T340-660q-13 0-21.5 8.5T310-630v40h-40q-13 0-21.5 8.5T240-560q0 13 8.5 21.5T270-530h40v40q0 13 8.5 21.5T340-460Z"/></svg></div>
        <div id="guideBtn"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#001d3d"><path d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"/></svg></div>
        <div id="faqBtn"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#001d3d"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"/></svg></div>
        <div class="leaderboard_btn">LEADERBOARDS</div>
    </div>

    <div class="parent">
        <div class="gamebox" style="margin: 3vw;"><!-- left box -->
            <div class="skin">
                <img src="{{ image1 }}" alt="{{ item1.market_hash_name }}">
            </div>

            <a href="/item1" data-preserve-score="true" onclick="window.__preserveScore=true">
            <div class="skin_text_box">

                <p class="skin_text"> {{ item1.market_hash_name }}<br></p>
                <!-- p class="skin_text"> {{ item1.price }} USD</p --> <!-- DELETE LATER -->
            </div>
            </a>
        </div>

        <div class="gamebox" style="margin: 3vw;"><!-- right box -->
            <div class="skin">
                <img src="{{ image2 }}" alt="{{ item2.market_hash_name }}">
            </div>

            <a href="/item2" data-preserve-score="true" onclick="window.__preserveScore=true">

            <div class="skin_text_box">
                <p class="skin_text"> {{ item2.market_hash_name }}<br></p>
                <!-- p class="skin_text"> {{ item2.price }} USD</p --> <!-- DELETE LATER -->

            </div>
            </a>
        </div>
        </div>

    <script>
        (function(){
            let preserveScore = false;

            // Clicks on guess links should NOT reset the score
            const guessLinks = document.querySelectorAll('a[data-preserve-score="true"]');
            guessLinks.forEach(a => a.addEventListener('click', () => { preserveScore = true; }));

            // Also set the flag as early as possible on pointerdown/mousedown in capture phase
            function markPreserveIfGuessLink(ev){
                const t = ev.target;
                if (t && typeof t.closest === 'function') {
                    const link = t.closest('a[data-preserve-score="true"]');
                    if (link) {
                        window.__preserveScore = true;
                        preserveScore = true;
                    }
                }
            }
            document.addEventListener('pointerdown', markPreserveIfGuessLink, { capture: true });
            document.addEventListener('mousedown', markPreserveIfGuessLink, { capture: true });

            function sendReset() {
                if (preserveScore || window.__preserveScore) return;
                const url = '/reset_score';
                try {
                    if (navigator.sendBeacon) {
                        const blob = new Blob([], { type: 'text/plain' });
                        navigator.sendBeacon(url, blob);
                    } else if (window.fetch) {
                        fetch(url, { method: 'POST', keepalive: true, headers: { 'Content-Type': 'text/plain' }, body: '' });
                    } else {
                        // Last-resort fallback
                        const i = new Image();
                        i.src = url;
                    }
                } catch (e) {
                    // swallow
                }
            }

            // Trigger when the document becomes hidden or the page is being unloaded
            window.addEventListener('pagehide', sendReset);
            document.addEventListener('visibilitychange', function(){
                if (document.visibilityState === 'hidden') {
                    sendReset();
                }
            });
        })();
    </script>

   <script>
        // Redirects to Minigames page when button is clicked
        document.getElementById("minigamesBtn").onclick = function () {
			window.location.href = "{{ url_for('minigames') }}";
		};

         document.getElementById("guideBtn").onclick = function () {
			window.location.href = "{{ url_for('guide') }}";
		};

         document.getElementById("faqBtn").onclick = function () {
			window.location.href = "{{ url_for('faq') }}";
		};
   </script>



</body>
</html>